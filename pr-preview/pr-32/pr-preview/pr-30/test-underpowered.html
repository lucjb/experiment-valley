<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Underpowered Design</title>
    <script src="https://cdn.jsdelivr.net/npm/jstat@latest/dist/jstat.min.js"></script>
    <script src="js/challenge-generator.js"></script>
</head>
<body>
    <h1>Test Underpowered Design</h1>
    <div id="results"></div>
    
    <script>
        // Test the underpowered design
        console.log("Testing underpowered design...");
        
        // Generate a normal experiment
        const normalExperiment = winner().generate();
        console.log("Normal experiment sample size:", normalExperiment.experiment.requiredSampleSizePerVariant);
        
        // Generate an underpowered experiment
        const underpoweredExperiment = underpoweredTrap().generate();
        console.log("Underpowered experiment sample size:", underpoweredExperiment.experiment.requiredSampleSizePerVariant);
        
        // Analyze both experiments
        const normalAnalysis = analyzeExperiment(normalExperiment);
        const underpoweredAnalysis = analyzeExperiment(underpoweredExperiment);
        
        console.log("Normal analysis:", normalAnalysis.analysis);
        console.log("Underpowered analysis:", underpoweredAnalysis.analysis);
        
        // Display results
        const resultsDiv = document.getElementById('results');
        resultsDiv.innerHTML = `
            <h2>Normal Experiment</h2>
            <p>Sample Size: ${normalExperiment.experiment.requiredSampleSizePerVariant.toLocaleString()}</p>
            <p>Has Underpowered Design: ${normalAnalysis.analysis.hasUnderpoweredDesign}</p>
            ${normalAnalysis.analysis.underpoweredDesign ? `
                <p>Correct Sample Size: ${normalAnalysis.analysis.underpoweredDesign.correctSampleSize.toLocaleString()}</p>
                <p>Difference: ${normalAnalysis.analysis.underpoweredDesign.sampleSizeDifference.toLocaleString()}</p>
            ` : ''}
            
            <h2>Underpowered Experiment</h2>
            <p>Sample Size: ${underpoweredExperiment.experiment.requiredSampleSizePerVariant.toLocaleString()}</p>
            <p>Has Underpowered Design: ${underpoweredAnalysis.analysis.hasUnderpoweredDesign}</p>
            ${underpoweredAnalysis.analysis.underpoweredDesign ? `
                <p>Correct Sample Size: ${underpoweredAnalysis.analysis.underpoweredDesign.correctSampleSize.toLocaleString()}</p>
                <p>Difference: ${underpoweredAnalysis.analysis.underpoweredDesign.sampleSizeDifference.toLocaleString()}</p>
                <p>Percentage Underpowered: ${underpoweredAnalysis.analysis.underpoweredDesign.percentageUnderpowered}%</p>
            ` : ''}
            
            <h2>Comparison</h2>
            <p>Sample size difference: ${(normalExperiment.experiment.requiredSampleSizePerVariant - underpoweredExperiment.experiment.requiredSampleSizePerVariant).toLocaleString()}</p>
            <p>Underpowered detected: ${underpoweredAnalysis.analysis.hasUnderpoweredDesign ? 'YES' : 'NO'}</p>
        `;
    </script>
</body>
</html>
